if(window.rcmail){rcmail.addEventListener("init",function(){rcmail.addEventListener("plugin.carddav_server_message",carddav_server_message);rcmail.addEventListener("plugin.carddav_server_success",carddav_server_success);rcmail.register_command("plugin.carddav-server-save",carddav_server_add,!0);rcmail.register_command("plugin.carddav-server-delete",function(a){rcmail.http_post("plugin.carddav-server-delete","_remote=1&_carddav_server_id="+$.base64Encode(a),rcmail.display_message(rcmail.gettext("settings_delete_loading",
"carddav"),"loading"))},!0);rcmail.register_command("plugin.carddav-server-remove",function(a){rcmail.http_post("plugin.carddav-server-delete","_remote=1&_remove=1&_carddav_server_id="+$.base64Encode(a),rcmail.display_message(rcmail.gettext("settings_delete_loading","carddav"),"loading"))},!0);$("#_label").keypress(carddav_server_add_enter_event);$("#_server_url").keypress(carddav_server_add_enter_event);$("#_username").keypress(carddav_server_add_enter_event);$("#_password").keypress(carddav_server_add_enter_event);
$(".carddav_edit_label").focus(function(){var a=escape($(this).val());rcmail.env[$(this).attr("id")]=a});$(".carddav_edit_label").blur(function(){var a=$(this).attr("id"),c=encodeURIComponent($(this).val());try{rcmail.env[$(this).attr("id")]!=c&&($("#l"+$(this).attr("id")).css("visibility","visible"),rcmail.http_post("plugin.carddav-label-save","_remote=1&_label="+c+"&_id="+a))}catch(d){}});if($("#rcmfd_default_addressbook").get(0)){var a=$("#rcmfd_default_addressbook").children().get(0);0==$(a).val()&&
$(a).html(rcmail.gettext("carddav.defaultaddressbook")+" ("+rcmail.gettext("carddav.local")+")")}});var carddav_server_add_enter_event=function(a){13==a.keyCode&&carddav_server_add()},carddav_server_readonly=function(a,b){if(-1<a.src.indexOf("checked.png")){a.src=a.src.replace("checked.png","blank.gif");var c=0}else a.src=a.src.replace("blank.gif","checked.png"),c=1;$("#lcarddav_addressbook"+b).css("visibility","visible");rcmail.http_post("plugin.carddav-readonly-save","_remote=1&_readonly="+c+"&_id="+
b)},carddav_server_autocomplete=function(a,b){if(-1<a.src.indexOf("checked.png")){a.src=a.src.replace("checked.png","blank.gif");var c=0}else a.src=a.src.replace("blank.gif","checked.png"),c=1;$("#lcarddav_addressbook"+b).css("visibility","visible");rcmail.http_post("plugin.carddav-autocomplete-save","_remote=1&_autocomplete="+c+"&_id="+b)},carddav_server_index=function(a){var b=a.id.replace("s",""),c=a.value,d="";try{var e=a.className.replace("c",""),f=$($(".c"+a.value)).get(0).id.replace("s",""),
d="&_old_target_id="+f+"&_old_target_idx="+e;$("#lcarddav_addressbook"+f).css("visibility","visible")}catch(g){}$(".c"+a.value).val(e);$("#lcarddav_addressbook"+b).css("visibility","visible");rcmail.http_post("plugin.carddav-idx-save","_remote=1&_target_id="+b+"&_target_idx="+c+d)},carddav_server_add=function(){try{var a=rcube_find_object("_label"),b=rcube_find_object("_server_url"),c=rcube_find_object("_username"),d=rcube_find_object("_password"),e=rcube_find_object("_read_only"),f=rcube_find_object("_autocomplete"),
g=rcube_find_object("_idx");""==a.value||""==b.value?""==a.value&&""==b.value||rcmail.display_message(rcmail.gettext("settings_empty_values","carddav"),"error"):rcmail.http_post("plugin.carddav-server-save","_remote=1&_idx="+$.base64Encode(g.value)+"&_label="+$.base64Encode(a.value)+"&_server_url="+b.value+"&_username="+$.base64Encode(c.value)+"&_password="+$.base64Encode(d.value)+"&_read_only="+$.base64Encode(!0===e.checked?"1":"0")+"&_autocomplete="+$.base64Encode(!0===f.checked?"1":"0"),rcmail.display_message(rcmail.gettext("settings_init_server",
"carddav"),"loading"))}catch(h){}},carddav_server_message=function(a){if(a.check){$("#carddav_server_list").slideUp();var b="larry"==rcmail.env.skin?$("table.propform").get(0):$("table").get(0);$(b).html('<tbody><tr><td style="width: auto;">'+a.server_list+"</td></tr></tbody>");$("table.propform td").css("width","auto");$("#carddav_server_list").slideDown();b="confirmation";a.type&&(b=a.type);rcmail.display_message(a.message,b)}else rcmail.display_message(a.message,"error")},carddav_server_success=
function(a){window.setTimeout("$('.loadingsmall').css('visibility', 'hidden');",1E3);rcmail.display_message(a.message,"confirmation")}};