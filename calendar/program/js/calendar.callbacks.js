function calendar_callbacks(){this.setTimeline=function(){var a=$(".fc-agenda-slots:visible").parent(),c=a.children(".timeline");rcmail.env.calendar_timeline=c;0==c.length&&(c=$("<hr>").addClass("timeline"),a.prepend(c));var b=new Date,d=$("#calendar").fullCalendar("getView");d.visStart<b&&d.visEnd>b?c.show():c.hide();b=(3600*b.getHours()+60*b.getMinutes()+b.getSeconds())/86400;a=Math.floor(a.height()*b);c.css("top",a+"px");if("agendaWeek"==d.name||"agendaDay"==d.name){var a=1,b=0,f,g;if("agendaWeek"==
d.name){g=$("#calendar .fc-today:visible");try{b=g.position().left,f=g.width()+"px"}catch(e){c.hide()}}"agendaDay"==d.name&&(b=70,a=0,f="100%");0<b&&c.css({left:b+a+"px",width:f})}else c.hide()};this.viewDisplay=function(a,c){var b=$("#calendar").fullCalendar("getDate");wn=b.getWeekOfYearStartMonday(b);var d=new Date(b.getFullYear(),b.getMonth(),1,0,0,0);bds=b.getWeekOfYearStartMonday(d);d=new Date(b.getFullYear(),b.getMonth(),b.getDaysInMonth(),23,59,59);eds=b.getWeekOfYearStartMonday(d);b=bds+" - "+
eds;"month"==a.name&&($("#monthbut").focus(),$("#datepicker-title").html("<center>"+a.title+"</center>"),$("#weeknumber").html("<center>"+c.settings.calendar_week+": "+b+"</center>"));"agendaDay"==a.name&&($("#daybut").focus(),$("#datepicker-title").html("<center>"+a.title+"</center>"),$("#weeknumber").html("&nbsp;"));"agendaWeek"==a.name&&($("#weekbut").focus(),$("#datepicker-title").html("<center>"+a.title+"</center>"),$("#weeknumber").html("<center>"+c.settings.calendar_week+": "+wn+"</center>"));
if("agendaWeek"==a.name||"agendaDay"==a.name){f&&window.clearInterval(f);var f=window.setInterval(calendar_callbacks.setTimeline,1E4);try{calendar_callbacks.setTimeline()}catch(g){}}else rcmail.env.calendar_timeline&&rcmail.env.calendar_timeline.hide()};this.qtip=function(a,c){return c=calendar_common.qtip(a,c)};this.loading=function(a,c){var b=$("#calendar").fullCalendar("getView"),d=(new Date).getTime(),f=b.start.getTime(),b=b.end.getTime();$("#todaybut").attr("title",new Date(d));d<f||d>b?$("#todaybut").prop("disabled",
!1):$("#todaybut").prop("disabled",!0);a?($("#calendaroverlay").show(),c||(c=rcmail.set_busy(!0,"loading")),rcmail.enable_command("plugin.calendar_print",!1)):(rcmail.set_busy(!1,"loading",c),$("#calendaroverlay").hide(),rcmail.env.calpopup&&(rcmail.env.calpopup=calendar_commands.previewPrintEvents()),"show"!=rcmail.env.action&&calendar_commands.triggerSearch());c&&(rcmail.env.calendar_msgid=c);return c};this.eventRender_upcoming=function(a,c,b,d){c=this.qtip(a,c);a.end&&1!=a.allDay?(b=a.end.format(js_time_formats[rcmail.env.rc_time_format]),
c.find(".fc-event-title").html(" - "+b+" "+a.title)):calendar_common.modifyEvents(a,c,b,d);a.onclick&&c.bind("click",function(){})};this.eventRender=function(a,c,b,d){rcmail.enable_command("plugin.calendar_print",!0);""==c.find("span.fc-event-title").html()&&c.find("span.fc-event-title").html("&nbsp;");c=this.qtip(a,c);if("month"!=b.name){if(a.className&&!a.allDay){var f=a.classNameDisp;f||(f=a.className);"null"==f&&(f="");""!=f&&c.find("div.fc-event-title").after('<div class="fc-event-categories">['+
f+"]</div>")}a.location&&c.find("div.fc-event-title").after('<div class="fc-event-location">@'+a.location+"</div>");a.description&&!a.allDay&&(f=a.description,20<f.length&&(f=f.substring(0,20)+" ..."),c.find("div.fc-event-title").after('<div class="fc-event-description">'+f+"</div>"));f=".fc-event-time";if(a.allDay&&(calendar_common.modifyEvents(a,c,b,d),f=".fc-event-title",0!=a.rr))var g=c.find(".fc-event-title").html();0!=a.rr&&(g=c.find(f).html(),c.find(f).html(g+"&nbsp;<img style='padding: 0 1px' src='plugins/calendar/skins/"+
rcmail.env.skin+"/images/recur.png' />"));0!=a.reminderservice&&(g=c.find(f).html(),c.find(f).html(g+"&nbsp;<img style='padding: 0 1px' src='plugins/calendar/skins/"+rcmail.env.skin+"/images/reminder.png' />"))}"month"==b.name&&(a.end&&1!=a.allDay?(b=a.end.format(js_time_formats[rcmail.env.rc_time_format]),c.find(".fc-event-title").html(" - "+b+" "+a.title)):calendar_common.modifyEvents(a,c,b,d));a.onclick&&c.bind("click",function(){})};this.eventDragStart=function(a){rcmail.env.clone_gap=0;rcmail.env.allday_drag=
8634E4<=a.end.getTime()-a.start.getTime()&&864E5>=a.end.getTime()-a.start.getTime()?!0:!1;a.clone&&(rcmail.env.clone_gap=a.start.getTime()/1E3-a.clone);rcmail.env.replication_complete||rcmail.display_message(rcmail.gettext("backgroundreplication","calendar"),"error")};this.eventDrop=function(a,c,b,d,f,g){if(rcmail.env.replication_complete){d&&864E5>=a.end.getTime()-a.start.getTime()&&(a.start=new Date(a.start.getFullYear(),a.start.getMonth(),a.start.getDate(),0,0,0),a.end=new Date(a.start.getFullYear(),
a.start.getMonth(),a.start.getDate(),23,59,0));rcmail.env.allday_drag&&!d&&(a.end=new Date(a.start.getTime()+1E3*rcmail.env.calsettings.settings.duration));rcmail.env.edit_event=a;rcmail.env.edit_dayDelta=c;rcmail.env.edit_minuteDelta=b;rcmail.env.edit_allDay=d;rcmail.env.edit_revertFunc=f;c=0;if(a.clone){if(!rcmail.env.edit_recurring){calendar_commands.edit_recurring_html("move");return}"initial"==rcmail.env.edit_recurring&&(a.start=new Date(a.start.getTime()-1E3*rcmail.env.clone_gap),a.end=new Date(a.end.getTime()-
1E3*rcmail.env.clone_gap),c=1)}0!=a.rr&&(c=1);b=(new Date).getTime();if(a.past&&a.end.getTime()>=b||!a.past&&a.end.getTime()<b){if(a.past&&a.end.getTime()>=b){var e="#"+a.color_save;a.past=!1}!a.past&&a.end.getTime()<b&&(e="#"+lighter(a.backgroundColor,50),a.past=!0);a.color=e;a.backgroundColor=e;a.borderColor=e}e="";rcmail.env.edit_recurring&&(e="&_mode="+rcmail.env.edit_recurring);rcmail.env.clone_gap&&(e=e+"&_gap="+rcmail.env.clone_gap);rcmail.env.edit_recurring=!1;$("#calendaroverlay").show();
msgid=rcmail.set_busy(!0,"loading");rcmail.http_post("plugin.moveEvent","_event_id="+a.id+"&_uid="+a.uid+"&_start="+Math.round(a.start.getTime()/1E3)+"&_end="+Math.round(a.end.getTime()/1E3)+"&_allDay="+d+"&_refetch="+c+"&_reminder="+a.reminder+"&_msgid="+msgid+e);calendar_gui.upcoming(g)}else rcmail.display_message(rcmail.gettext("backgroundreplication","calendar"),"error"),f(a,c,b,d,f,g)};this.eventResizeStop=function(){rcmail.env.replication_complete||(rcmail.display_message(rcmail.gettext("backgroundreplication",
"calendar"),"error"),$("#calendar").fullCalendar("refetchEvents"))};this.eventResize=function(a,c){if(rcmail.env.replication_complete){var b=0;rcmail.env.edit_event=a;rcmail.env.edit_delta=c;if(a.clone){if(!rcmail.env.edit_recurring){calendar_commands.edit_recurring_html("resize");return}"initial"==rcmail.env.edit_recurring&&(b=a.start.getTime()/1E3-a.clone,a.start=new Date(1E3*a.clone),a.end=new Date(a.end.getTime()-1E3*b),b=1)}var d=(new Date).getTime();if(a.past&&a.end.getTime()>=d||!a.past&&a.end.getTime()<
d){if(a.past&&a.end.getTime()>=d){var f="#"+a.color_save;a.past=!1}!a.past&&a.end.getTime()<d&&(f="#"+lighter(a.backgroundColor,50),a.past=!0);a.color=f;a.backgroundColor=f;a.borderColor=f}f="";rcmail.env.edit_recurring&&(f="&_mode="+rcmail.env.edit_recurring);rcmail.env.edit_recurring=!1;$("#calendaroverlay").show();msgid=rcmail.set_busy(!0,"loading");rcmail.http_post("plugin.resizeEvent","_event_id="+a.id+"&_uid="+a.uid+"&_start="+Math.round(a.start.getTime()/1E3)+"&_end="+Math.round(a.end.getTime()/
1E3)+"&_allDay="+a.allDay+"&_reminder="+a.reminder+"&_refetch="+b+"&_msgid="+msgid+f)}else rcmail.display_message(rcmail.gettext("backgroundreplication","calendar"),"error")};this.select=function(a,c,b,d,f,g){this.dayClick(a,b,d,f,g,c)};this.dayClick=function(a,c,b,d,f,g){if(b)if(rcmail.env.replication_complete){$("#catprotected").remove();var e=$("#event");try{if(!0===e.dialog("isOpen"))return}catch(h){}a||(a=new Date(a.getTime()/1E3));g||(g=new Date(1E3*(a.getTime()/1E3+f.settings.duration)));rcmail.env.cal_remindermailto&&
$("#remindermailto").html(rcmail.env.cal_remindermailto);calendar_gui.resetForm(e);calendar_gui.initTabs(2,3);$("#hoursel").attr("checked",!0);calendar_gui.initExpireDatepicker(g,f);calendar_gui.initStartdateDatepicker(a,f);calendar_gui.initEnddateDatepicker(g,f);calendar_gui.initReminderDatepicker(a,f);calendar_gui.reminderControls();var t=$("#summary"),m=$("#description"),s=$("#categories");s||(s="");var n=$("#location"),p=$("#expires");b=a.getHours()+"";2>b.length&&(b="0"+b);d=a.getMinutes()+"";
2>d.length&&(d="0"+d);b=b+":"+d;c&&"month"!=$("#calendar").fullCalendar("getView").name&&(b="00:00");$("#starttime").val(b);var v=$("#starttime").val();b=g.getHours()+"";2>b.length&&(b="0"+b);g=g.getMinutes()+"";2>g.length&&(g="0"+g);g=b+":"+g;c&&(g="23:59");$("#endtime").val(g);var A=$("#endtime").val();$("#occurrences").val(0);var w=$("#recursel");w.val(0);calendar_gui.toggleRecur();var x=$("#calimport");g=rcmail.gettext("save","calendar");b=rcmail.gettext("cancel","calendar");d={};d[g]=function(){if(x.get(0)&&
""!=x.val()){e.dialog("close");$("#calendaroverlay").show();rcmail.env.calendar_msgid=rcmail.set_busy(!0,"loading");var b=$('<iframe name="uploader" id="uploader" src="" style="width:0;height:0;visibility:hidden;" />');$("body").append(b);$("#form").submit();$("#uploader").load(function(){$("#calendar").fullCalendar("removeEvents");$("#calendar").fullCalendar("refetchEvents");rcmail.set_busy(!1,"loading",rcmail.env.calendar_msgid);$("#calendaroverlay").hide();x.val("")});return!1}if($("#event-3").is(":visible"))return!1;
var b=$.trim($("#starttime").val()),d=$.trim($("#startdate").val()),g=$.trim($("#endtime").val());if(b!=v||g!=A)c=!1;var h=$.trim($("#enddate").val());h+" "+g>p.val()&&p.val(h+" "+g);if(0!=w.val()&&(j=p.val().split(" "),j[0]<=h&&0==$("#occurrences").val()&&confirm(rcmail.gettext("calendar.verifyexpiredate"))))return $("#tab2").trigger("click"),p.val(j[0]),p.focus(),!1;var j=a.getFullYear(),q=a.getMonth()+1+"";2>q.length&&(q="0"+q);var z=a.getDate()+"";2>z.length&&(z="0"+z);h+" "+g<=j+"-"+q+"-"+z+
" "+b&&(g=a.getTime()/1E3+f.settings.duration,g=new Date(1E3*g),b=g.getHours()+"",2>b.length&&(b="0"+b),j=a.getMinutes()+"",2>j.length&&(j="0"+j),g=$("#endtime").val(b+":"+j));var j=$("#starttime").val(),j=j.split(":"),g=j[0],h=j[1],j=$("#endtime").val(),j=j.split(":"),b=j[0],j=j[1],j=d.split("-"),b=new Date(parseFloat(j[0]),parseFloat(j[1])-1,parseFloat(j[2]),parseFloat(g),parseFloat(h),0),d=$("#remindercustom").val(),j=d.split(" "),d=j[0];if(j=j[1])j=j.split(":"),g=j[0],h=j[1],j=d.split("-"),d=
new Date(parseFloat(j[0]),parseFloat(j[1])-1,parseFloat(j[2]),parseFloat(g),parseFloat(h),0),d=(b.getTime()-d.getTime())/1E3,$("#durationcustom").val(d);b=$("#occurrences");""==b.val()&&b.val(0);rrsec=recv=w.val();rrsec=recv.substr(0,1);recv=recv.substr(1);switch(rrsec){case "d":recv*=parseInt($("#dnums").val());break;case "w":recv*=parseInt($("#wnums").val());break;case "m":recv*=parseInt($("#mnums").val());break;case "y":recv*=parseInt($("#ynums").val())}recv=rrsec+recv;var u="",y=-1,C=0;mydays=
"SU MO TU WE TH FR SA".split(" ");$("#form input[type=checkbox]").each(function(){y++;this.checked&&(C=y,u=7>y?u+mydays[y]+",":u+(y-6)+",")});u=u.substr(0,u.length-1);d="";6<C?d="&_bymonthday="+u:""!=u&&(d="&_byday="+u);"m"==rrsec?0!=$("xmevery").val()&&0!=$("#mweekday").val()&&(d="&_byday="+$("#mevery").val()+$("#mweekday").val()):"y"==rrsec&&(0!=$("#yevery").val()&&0!=$("yweekday").val()&&(d="&_byday="+$("#yevery").val()+$("#yweekday").val()),0!=$("#ymonth").val()&&(d=d+"&_bymonth="+$("#ymonth").val()),
0!=$("#ydnums").val()&&0!=$("#ymonthday").val()&&(d=d+"&_bymonthday="+$("#ydnums").val()+"&_bymonth="+$("#ymonthday").val()));$("#calendaroverlay").show();msgid=rcmail.set_busy(!0,"loading");for(0==recv&&$("#occurrences").val(0);-1<t.val().indexOf("?");)t.val(t.val().replace("?","%3F"));for(;-1<m.val().indexOf("?");)m.val(m.val().replace("?","%3F"));for(;-1<n.val().indexOf("?");)n.val(n.val().replace("?","%3F"));for(;-1<t.val().indexOf("&");)t.val(t.val().replace("&","%26"));for(;-1<m.val().indexOf("&");)m.val(m.val().replace("&",
"%26"));for(;-1<n.val().indexOf("&");)n.val(n.val().replace("&","%26"));rcmail.http_post("plugin.newEvent",$("#form").serialize()+"&_summary="+t.val()+"&_description="+m.val()+"&_location="+n.val()+"&_categories="+s.val()+"&_allDay="+c+"&_occurrences="+b.val()+"&_recur="+recv+d+"&_msgid="+msgid);e.dialog("close");rcmail.env.cal_search_string=""};d[b]=function(){e.dialog("close")};e.dialog({modal:!0,width:630,position:"center",zIndex:5001,title:rcmail.gettext("new_event","calendar"),close:function(){e.dialog("destroy");
e.hide()},buttons:d}).show();$("#summary").focus()}else rcmail.display_message(rcmail.gettext("backgroundreplication","calendar"),"error")};this.eventClick=function(a,c){if(a.editable&&!rcmail.env.replication_complete&&"false"==queryString("_event_id"))rcmail.display_message(rcmail.gettext("backgroundreplication","calendar"),"error");else if(a.onclick)-1<a.onclick.indexOf("?_task=mail&_action=compose")?"function"==typeof opencomposewindow?opencomposewindow(a.onclick):window.open(a.onclick):window.open(a.onclick);
else{rcmail.env.edit_event=a;if(a.clone&&a.editable){if(!rcmail.env.edit_recurring){calendar_commands.edit_recurring_html("edit");return}switch(rcmail.env.edit_recurring){case "initial":if(a.initial){a=a.initial;a.start=new Date(1E3*a.start_unix);var b=0;a.allDay&&(b=parseInt(a.start.getTimezoneOffset()));a.start=new Date(1E3*(parseInt(a.start_unix)+60*b));a.end&&(a.end=new Date(1E3*a.end_unix),b=0,a.allDay&&(b=parseInt(a.end.getTimezoneOffset())),a.end=new Date(1E3*(parseInt(a.end_unix)+60*b)));
rcmail.env.edit_recurring=!1;$("#calendaroverlay").hide();$("#calendaroverlay").html("")}else{calendar_commands.gotoDate(a.clone,a.id);return}break;case "single":var d=a.start_unix;break;case "future":a.occurrences=Math.max(0,a.occurrences-a.hasoccurred)}}a.end||(a.end=new Date(a.start.getTime()+1E3*c.settings.duration));var f=$("#event");calendar_gui.resetForm(f);calendar_gui.initTabs(3,2);b=a.start;calendar_gui.initExpireDatepicker(a.start,c);calendar_gui.initStartdateDatepicker(a.start,c);calendar_gui.initEnddateDatepicker(a.start,
c);calendar_gui.initReminderDatepicker(a.start,c);shour=b.getHours()+"";2>shour.length&&(shour="0"+shour);sminute=b.getMinutes()+"";2>sminute.length&&(sminute="0"+sminute);$("#starttime").val(shour+":"+sminute);var g=$("#starttime").val(),e=a.end;ehour=e?e.getHours()+"":"0";2>ehour.length&&(ehour="0"+ehour);eminute=e?e.getMinutes()+"":"0";2>eminute.length&&(eminute="0"+eminute);b=e.getDate()+"";2>b.length&&(b="0"+b);var h=e.getMonth()+1+"";2>h.length&&(h="0"+h);e=e.getFullYear()+"";$("#enddate").val(e+
"-"+h+"-"+b);$("#endtime").val(ehour+":"+eminute);var t=$("#endtime").val(),m=$("#summary").val(a.title),s=$("#description").val(a.description),n=$("#location").val(a.location),p=$("#categories"),v=a.classNameDisp;a.classNameICS&&(v=a.classNameICS);v||(v=a.className);""!=v?p.val(v):p.prop("selectedIndex",0);a.classProtected&&a.editable?(p.prop("disabled",!0),$("#catprotected").remove(),p.parent().append('<span id="catprotected">&nbsp;<i>('+rcmail.gettext("calendar.protected")+")</i></span>")):$("#catprotected").remove();
var A=p.val(),b=(new Date(1E3*(parseInt(a.expires)+3600*parseInt((new Date(a.start)).getTimezoneOffset()/60)))).format("yyyy-MM-dd"),w=$("#expires").val(b),x=$("#occurrences").val(a.occurrences);$("#export_as_file").attr("href","./?_task=dummy&_action=plugin.calendar_single_export_as_file&_id="+a.id+"&_edit="+a.editable);$("#send_invitation").attr("href","./?_task=dummy&_action=plugin.calendar_send_invitation&_id="+a.id+"&_edit="+a.editable);var k=!1;switch(a.rr){case "d":k=86400;break;case "w":k=
604800;break;case "m":k=2592E3;break;case "y":k=31536E3}var B=$("#recursel");a.recur&&0!=a.recur&&k&&B.val(a.rr+k);calendar_gui.toggleRecur("recursel");if(rrsec=k=B.val())rrsec=k.substr(0,1),k=k.substr(1);b=[];b.SU=0;b.MO=1;b.TU=2;b.WE=3;b.TH=4;b.FR=5;b.SA=6;h=a.byday.split(",");switch(rrsec){case "d":$("#dnums").val(parseInt(a.recur)/86400);break;case "w":$("#wnums").val(parseInt(a.recur)/604800);if(0!=a.byday){calendar_gui.currentStyle("byweekdayslink")&&$("#byweekdayslink").click();for(var e=document.forms.form,
r=0;r<e.elements.length&&"checkbox"!=e.elements[r].type;r++);for(var l=0;l<h.length;l++)if(void 0!=typeof b[h[l]])try{e.elements[r+b[h[l]]].checked=!0}catch(j){}}break;case "m":$("#mnums").val(parseInt(a.recur)/2592E3);if(0!=a.bymonthday){calendar_gui.currentStyle("bymonthdayslink")&&$("#bymonthdayslink").click();h=a.bymonthday.split(",");e=document.forms.form;for(r=0;r<e.elements.length&&"checkbox"!=e.elements[r].type;r++);for(l=0;l<h.length;l++)0<h[l]&&(e.elements[r+7+parseInt(h[l])].checked=!0)}0!=
a.byday&&(calendar_gui.currentStyle("byweekdaylink")&&$("#byweekdaylink").click(),$("#mweekday").val(a.byday.substr(a.byday.length-2)),$("#mevery").val(a.byday.substr(0,a.byday.length-2)));break;case "y":$("#ynums").val(parseInt(a.recur)/31536E3),0!=a.bymonthday&&0!=a.bymonth&&(calendar_gui.currentStyle("bymonthdaylink")&&$("#bymonthdaylink").click(),$("#ydnums").val(a.bymonthday),$("#ymonthday").val(a.bymonth)),0!=a.byday&&(0!=a.bymonth&&0==a.bymonthday)&&(calendar_gui.currentStyle("byyeardaylink")&&
$("#byyeardaylink").click(),$("#yweekday").val(a.byday.substr(a.byday.length-2)),$("#yevery").val(a.byday.substr(0,a.byday.length-2)),$("#ymonth").val(a.bymonth))}if(0!=a.reminderservice)switch($("#reminderenable").attr("checked",!0),a.reminderservice){case "email":$("#remindertype").prop("selectedIndex",0);$("#remindermailto").prop("disabled",!1);break;case "popup":$("#remindertype").prop("selectedIndex",1),$("#remindermailto").prop("disabled",!0)}else $("#reminderdisable").attr("checked",!0);a.remindermailto&&
(b=a.remindermailto,0<$('#remindermailto option[value="'+b+'"]').length?("caldav"==rcmail.env.cal_backend&&(rcmail.env.cal_remindermailto=$("#remindermailto").html(),$("#remindermailto").html('<option value="'+a.remindermailto+'">'+a.remindermailto+"</option>")),$("#remindermailto").val(b)):0!=a.remindermailto&&(h=$("#remindermailto").html(),h=h+'<option value="'+a.remindermailto+'">'+a.remindermailto+"</option>\r\n",$("#remindermailto").html(h),$("#remindermailto").val(b)));if(0<a.reminder){if(h=
!0,1<=a.reminder/604800?(b=a.reminder/604800,b==Math.round(b)&&0<$("#reminderweeksbefore option[value="+b+"]").length&&($("#weeksel").attr("checked",!0),$("#reminderweeksbefore").val(b),h=!1)):1<=a.reminder/86400?(b=a.reminder/86400,b==Math.round(b)&&0<$("#reminderdaysbefore option[value="+b+"]").length&&($("#daysel").attr("checked",!0),$("#reminderdaysbefore").val(b),h=!1)):1<=a.reminder/3600?(b=a.reminder/3600,b==Math.round(b)&&0<$("#reminderhoursbefore option[value="+b+"]").length&&($("#hoursel").attr("checked",
!0),$("#reminderhoursbefore").val(b),h=!1)):1<=a.reminder/60&&(b=a.reminder/60,b==Math.round(b)&&0<$("#reminderminutesbefore option[value="+b+"]").length&&($("#minsel").attr("checked",!0),$("#reminderminutesbefore").val(b),h=!1)),h){$("#customreminder").attr("checked",!0);var q=new Date(a.start.getTime()-1E3*a.reminder),b=q.getFullYear(),h=q.getMonth()+1+"";2>h.length&&(h="0"+h);e=q.getDate()+"";2>e.length&&(e="0"+e);l=q.getHours()+"";2>l.length&&(l="0"+l);q=q.getMinutes()+"";2>q.length&&(q="0"+q);
$("#remindercustom").val(b+"-"+h+"-"+e+" "+l+":"+q)}}else $("#hoursel").attr("checked",!0);calendar_gui.reminderControls();rcmail.env.event_initial=$("#form").serialize();b=rcmail.gettext("save","calendar");h=rcmail.gettext("remove","calendar");e=rcmail.gettext("cancel","calendar");l={};a.editable||"undefined"==typeof a.editable?(l[b]=function(){if(rcmail.env.event_initial==$("#form").serialize())$("#rcmrow"+a.id).removeClass("selected"),$("#rcmmatch"+a.id).removeClass("calsearchmatchselected"),$("#rcmmatch"+
a.id).addClass("calsearchmatch");else{a.title=m.val();a.description=s.val();a.location=n.val();a.className=p.val();var b=$.trim($("#starttime").val()),c=$.trim($("#endtime").val());if(b!=g||c!=t)a.allDay=!1;var c=$("#starttime").val(),c=c.split(":"),b=c[0],e=c[1],c=$("#endtime").val();c.split(":");startdate=$("#startdate").val();c=startdate.split("-");b=new Date(parseFloat(c[0]),parseFloat(c[1])-1,parseFloat(c[2]),parseFloat(b),parseFloat(e),0);c=$("#endtime").val();e=$("#enddate").val();e+" "+c>
w.val()+" "+$("#starttime").val()&&w.val(e+" "+c);c=$("#remindercustom").val();c=c.split(" ");e=c[0];if(c=c[1]){var c=c.split(":"),h=c[0],j=c[1],c=e.split("-"),c=new Date(parseFloat(c[0]),parseFloat(c[1])-1,parseFloat(c[2]),parseFloat(h),parseFloat(j),0),c=(b.getTime()-c.getTime())/1E3;$("#durationcustom").val(c)}w.val().split("-");""==x.val()&&x.val(0);b="";$("#categories").val()&&(b=b+"&_categories="+p.val());a.token&&(b=b+"&_ct="+a.token);a.userid&&(b=b+"&_userid"+a.userid);rrsec=k=B.val();rrsec=
k.substr(0,1);k=k.substr(1);switch(rrsec){case "d":k*=parseInt($("#dnums").val());break;case "w":k*=parseInt($("#wnums").val());break;case "m":k*=parseInt($("#mnums").val());break;case "y":k*=parseInt($("#ynums").val())}k=rrsec+k;c=document.forms.form;e="";h=-1;j=0;mydays="SU MO TU WE TH FR SA".split(" ");for(r=0;r<c.elements.length;r++)"checkbox"==c.elements[r].type&&(h++,!0==c.elements[r].checked&&(j=h,e=7>h?e+mydays[h]+",":e+(h-6)+","));e=e.substr(0,e.length-1);6<j?b="&_bymonthday="+e:""!=e&&(b=
"&_byday="+e);"m"==rrsec?0!=$("#mevery").val()&&0!=$("#mweekday").val()&&(b="&_byday="+$("#mevery").val()+$("#mweekday").val()):"y"==rrsec&&(0!=$("#yevery").val()&&0!=$("#yweekday").val()&&(b="&_byday="+$("#yevery").val()+$("#yweekday").val()),0!=$("#ymonth").val()&&(b=b+"&_bymonth="+$("#ymonth").val()),0!=$("#ydnums").val()&&0!=$("#ymonthday").val()&&(b=b+"&_bymonthday="+$("#ydnums").val()+"&_bymonth="+$("#ymonthday").val()));$("#calendaroverlay").show();msgid=rcmail.set_busy(!0,"loading");c=0;rcmail.env.recurselnever&&
(c=1);0==k&&$("#occurrences").val(0);e=0;v!=p.val()&&(e=1);a.recurrence_id&&(b=b+"&_recurrence_id="+a.recurrence_id);d&&(b=b+"&_recurrence_id="+d);for(rcmail.env.edit_recurring&&(b=b+"&_mode="+rcmail.env.edit_recurring);-1<m.val().indexOf("?");)m.val(m.val().replace("?","%3F"));for(;-1<s.val().indexOf("?");)s.val(s.val().replace("?","%3F"));for(;-1<n.val().indexOf("?");)n.val(n.val().replace("?","%3F"));for(;-1<m.val().indexOf("&");)m.val(m.val().replace("&","%26"));for(;-1<s.val().indexOf("&");)s.val(s.val().replace("&",
"%26"));for(;-1<n.val().indexOf("&");)n.val(n.val().replace("&","%26"));rcmail.http_post("plugin.editEvent",$("#form").serialize()+"&_event_id="+a.id+"&_uid="+a.uid+"&_summary="+m.val()+"&_description="+s.val()+"&_location="+n.val()+"&_categories="+p.val()+"&_old_categories="+A+"&_allDay="+a.allDay+"&_occurrences="+x.val()+"&_recur="+k+b+"&_recurselnever="+c+"&_reload="+e+"&_edit=1&_msgid="+msgid+b);rcmail.env.cal_search_string=""}f.dialog("close")},l[h]=function(){var b="";rcmail.env.edit_recurring&&
(b="&_mode="+rcmail.env.edit_recurring);$("#rcmrow"+a.id).remove();$("#calendaroverlay").show();msgid=rcmail.set_busy(!0,"loading");rcmail.http_post("plugin.removeEvent","_event_id="+a.id+"&_start="+a.start_unix+"&_msgid="+msgid+"&_uid="+a.uid+b);$("#calendar").fullCalendar("removeEvents",a.id);$("#upcoming").fullCalendar("removeEvents",a.id);f.dialog("close");rcmail.env.cal_search_string="";calendar_commands.triggerSearch()}):$("input, textarea, select","#form").each(function(){$(this).prop("disabled",
!0);$("#event").tabs("disable",1);$("#event").tabs("disable",3);$("#event").tabs("disable",4)});l[e]=function(){$("#rcmrow"+a.id).removeClass("selected");$("#rcmmatch"+a.id).removeClass("calsearchmatchselected");$("#rcmmatch"+a.id).addClass("calsearchmatch");f.dialog("close")};f.dialog({modal:!1,title:rcmail.gettext("edit_event","calendar"),width:630,zIndex:5001,position:"center",close:function(){f.dialog("destroy");f.hide();rcmail.env.edit_recurring=!1},buttons:l}).show();$("#summary").focus()}}}
calendar_callbacks=new calendar_callbacks;